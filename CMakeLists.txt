cmake_minimum_required(VERSION 3.20)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_C_STANDARD 11)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/$<CONFIG>")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/$<CONFIG>")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/$<CONFIG>")

project(quake-level-viewer LANGUAGES C CXX)

set(MASTER_PROJECT OFF)

if(CMAKE_CURRENT_SOURCE_DIR STREQUAL CMAKE_SOURCE_DIR)
	set(MASTER_PROJECT ON)
endif()

include(FetchContent)
FetchContent_Declare(raylib
	GIT_REPOSITORY git@github.com:raysan5/raylib.git
	GIT_SHALLOW TRUE
	GIT_TAG 4.5.0)

FetchContent_Declare(imgui
	GIT_REPOSITORY git@github.com:ocornut/imgui.git
	GIT_SHALLOW TRUE
	GIT_TAG v1.89.9)

FetchContent_Declare(rlimgui
	GIT_REPOSITORY git@github.com:raylib-extras/rlImGui.git
	GIT_SHALLOW TRUE
	GIT_TAG main)
FetchContent_MakeAvailable(raylib imgui rlimgui)

add_library(imgui STATIC
	${imgui_SOURCE_DIR}/imconfig.h
	${imgui_SOURCE_DIR}/imgui.h
	${imgui_SOURCE_DIR}/imgui_internal.h
	${imgui_SOURCE_DIR}/imstb_rectpack.h
	${imgui_SOURCE_DIR}/imstb_textedit.h
	${imgui_SOURCE_DIR}/imstb_truetype.h

	#
	${imgui_SOURCE_DIR}/imgui.cpp
	${imgui_SOURCE_DIR}/imgui_demo.cpp
	${imgui_SOURCE_DIR}/imgui_draw.cpp
	${imgui_SOURCE_DIR}/imgui_tables.cpp
	${imgui_SOURCE_DIR}/imgui_widgets.cpp)
target_include_directories(imgui PUBLIC ${imgui_SOURCE_DIR})

message(STATUS "${rlimgui_SOURCE_DIR}")
add_library(rlimgui STATIC
	${rlimgui_SOURCE_DIR}/rlimgui.h
	${rlimgui_SOURCE_DIR}/rlimguiColors.h
	${rlimgui_SOURCE_DIR}/rlimgui.cpp)
target_include_directories(rlimgui INTERFACE ${rlimgui_SOURCE_DIR})
target_link_libraries(rlimgui PRIVATE raylib imgui)

# NOTE: define our custom RL_CULL_DISTANCE_FAR, the default value causes some faces to be culled when viewing from a distance
target_compile_definitions(raylib
	PRIVATE
		EXTERNAL_CONFIG_FLAGS=1
		SUPPORT_MODULE_RSHAPES=1
		SUPPORT_MODULE_RTEXTURES=1
		SUPPORT_MODULE_RTEXT=1
		SUPPORT_MODULE_RMODELS=1
		SUPPORT_MODULE_RAUDIO=1
		SUPPORT_CAMERA_SYSTEM=1
		SUPPORT_GESTURES_SYSTEM=1
		SUPPORT_MOUSE_GESTURES=1
		SUPPORT_SSH_KEYBOARD_RPI=1
		SUPPORT_WINMM_HIGHRES_TIMER=1
		SUPPORT_PARTIALBUSY_WAIT_LOOP=1
		SUPPORT_SCREEN_CAPTURE=1
		SUPPORT_GIF_RECORDING=1
		SUPPORT_COMPRESSION_API=1
		MAX_FILEPATH_CAPACITY=8192
		MAX_FILEPATH_LENGTH=4096
		MAX_KEYBOARD_KEYS=512
		MAX_MOUSE_BUTTONS=8
		MAX_GAMEPADS=4
		MAX_GAMEPAD_AXIS=8
		MAX_GAMEPAD_BUTTONS=32
		MAX_TOUCH_POINTS=8
		MAX_KEY_PRESSED_QUEUE=16
		MAX_CHAR_PRESSED_QUEUE=16
		MAX_DECOMPRESSION_SIZE=64
		RL_DEFAULT_BATCH_BUFFERS=1
		RL_DEFAULT_BATCH_DRAWCALLS=256
		RL_DEFAULT_BATCH_MAX_TEXTURE_UNITS=4
		RL_MAX_MATRIX_STACK_SIZE=32
		RL_MAX_SHADER_LOCATIONS=32
		RL_CULL_DISTANCE_NEAR=0.01
		RL_CULL_DISTANCE_FAR=10000.0
		RL_DEFAULT_SHADER_ATTRIB_NAME_POSITION="vertexPosition"
		RL_DEFAULT_SHADER_ATTRIB_NAME_TEXCOORD="vertexTexCoord"
		RL_DEFAULT_SHADER_ATTRIB_NAME_NORMAL="vertexNormal"
		RL_DEFAULT_SHADER_ATTRIB_NAME_COLOR="vertexColor"
		RL_DEFAULT_SHADER_ATTRIB_NAME_TANGENT="vertexTangent"
		RL_DEFAULT_SHADER_ATTRIB_NAME_TEXCOORD2="vertexTexCoord2"
		RL_DEFAULT_SHADER_UNIFORM_NAME_MVP="mvp"
		RL_DEFAULT_SHADER_UNIFORM_NAME_VIEW="matView"
		RL_DEFAULT_SHADER_UNIFORM_NAME_PROJECTION="matProjection"
		RL_DEFAULT_SHADER_UNIFORM_NAME_MODEL="matModel"
		RL_DEFAULT_SHADER_UNIFORM_NAME_NORMAL="matNormal"
		RL_DEFAULT_SHADER_UNIFORM_NAME_COLOR="colDiffuse"
		RL_DEFAULT_SHADER_SAMPLER2D_NAME_TEXTURE0="texture0"
		RL_DEFAULT_SHADER_SAMPLER2D_NAME_TEXTURE1="texture1"
		RL_DEFAULT_SHADER_SAMPLER2D_NAME_TEXTURE2="texture2"
		SUPPORT_QUADS_DRAW_MODE=1
		SUPPORT_FILEFORMAT_PNG=1
		SUPPORT_FILEFORMAT_GIF=1
		SUPPORT_FILEFORMAT_QOI=1
		SUPPORT_FILEFORMAT_DDS=1
		SUPPORT_FILEFORMAT_HDR=1
		SUPPORT_IMAGE_EXPORT=1
		SUPPORT_IMAGE_GENERATION=1
		SUPPORT_IMAGE_MANIPULATION=1
		SUPPORT_DEFAULT_FONT=1
		SUPPORT_FILEFORMAT_FNT=1
		SUPPORT_FILEFORMAT_TTF=1
		SUPPORT_TEXT_MANIPULATION=1
		MAX_TEXT_BUFFER_LENGTH=1024
		MAX_TEXTSPLIT_COUNT=128
		SUPPORT_FILEFORMAT_OBJ=1
		SUPPORT_FILEFORMAT_MTL=1
		SUPPORT_FILEFORMAT_IQM=1
		SUPPORT_FILEFORMAT_GLTF=1
		SUPPORT_FILEFORMAT_VOX=1
		SUPPORT_FILEFORMAT_M3D=1
		SUPPORT_MESH_GENERATION=1
		MAX_MATERIAL_MAPS=12
		MAX_MESH_VERTEX_BUFFERS=7
		SUPPORT_FILEFORMAT_WAV=1
		SUPPORT_FILEFORMAT_OGG=1
		SUPPORT_FILEFORMAT_MP3=1
		SUPPORT_FILEFORMAT_QOA=1
		SUPPORT_FILEFORMAT_XM=1
		SUPPORT_FILEFORMAT_MOD=1
		AUDIO_DEVICE_FORMAT=ma_format_f32
		AUDIO_DEVICE_CHANNELS=2
		AUDIO_DEVICE_SAMPLE_RATE=0
		MAX_AUDIO_BUFFER_POOL_CHANNELS=16
		SUPPORT_STANDARD_FILEIO=1
		SUPPORT_TRACELOG=1
		MAX_TRACELOG_MSG_LENGTH=256
)

add_executable(quake-level-viewer raymath-extras.h quake-level-viewer.cpp)
target_link_libraries(quake-level-viewer raylib imgui rlimgui)
target_compile_definitions(quake-level-viewer PRIVATE MAP_SOURCE_DIR="${CMAKE_SOURCE_DIR}/quake_map_source")
